<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finance Pro + Analytics</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root { --primary:#6366f1; --income:#10b981; --expense:#f43f5e; --bg:#f8fafc; --text:#1e293b; }
body { font-family: Inter, sans-serif; background:var(--bg); margin:0; color:var(--text); }
nav { background:white; padding:1rem; border-bottom:1px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; }
.nav-brand { font-weight:800; color:var(--primary); }
.container { max-width:1100px; margin:30px auto; padding:0 20px; }
.page { display:none; }
.page.active { display:block; }
.card { background:white; padding:20px; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,0.1); margin-bottom:20px; }
.stats-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:20px; }
.stat-card p { font-size:1.8rem; font-weight:800; }
.visual-row { display:grid; grid-template-columns:1fr 1.5fr; gap:20px; }
.chart-container { height:300px; }
table { width:100%; border-collapse:collapse; }
th,td { padding:12px; border-bottom:1px solid #f1f5f9; }
.btn-edit { background:#fef9c3; border:none; padding:5px 10px; border-radius:4px; }
.btn-delete { background:#fee2e2; border:none; padding:5px 10px; border-radius:4px; color:#991b1b; }
.hidden { display:none; }
.form-group { margin-bottom:15px; display:flex; flex-direction:column; }
input,select,textarea { padding:10px; border-radius:8px; border:1px solid #cbd5e1; }
button { cursor:pointer; }
</style>
</head>

<body>

<nav>
<div class="nav-brand">ANALYTICS DASHBOARD</div>
<div>
<button onclick="showPage('dashboardPage')">Dashboard</button>
<button onclick="prepareNewEntry()" style="background:var(--primary);color:white;border:none;">+ Entry</button>
<button onclick="downloadCSV()">CSV</button>
<button onclick="downloadExcel()">Excel</button>
<button onclick="downloadChart()">Chart</button>
</div>
</nav>

<div class="container">

<div id="dashboardPage" class="page active">
<div class="stats-grid">
<div class="card stat-card"><h3>Income</h3><p style="color:var(--income)" id="dashIncome">$0</p></div>
<div class="card stat-card"><h3>Expenses</h3><p style="color:var(--expense)" id="dashExpense">$0</p></div>
<div class="card stat-card"><h3>Savings</h3><p id="dashBalance">$0</p></div>
</div>

<div class="visual-row">
<div class="card">
<h3>Monthly Overview</h3>
<div class="chart-container"><canvas id="monthlyChart"></canvas></div>
</div>

<div class="card">
<h3>History</h3>
<table>
<thead><tr><th>Date</th><th>Category</th><th>Amount</th><th>Action</th></tr></thead>
<tbody id="historyBody"></tbody>
</table>
</div>
</div>
</div>

<div id="inputPage" class="page">
<div class="card" style="max-width:500px;margin:auto;">
<h2 id="formTitle">Add Transaction</h2>
<input type="hidden" id="editIndex" value="-1">

<div class="form-group"><label>Date</label><input type="date" id="date"></div>

<div class="form-group">
<label>Type</label>
<select id="type" onchange="updateCategories()">
<option value="Income">Income</option>
<option value="Expense">Expense</option>
</select>
</div>

<div class="form-group">
<label>Category</label>
<select id="category"></select>
</div>

<div class="form-group"><label>Amount</label><input type="number" id="amount" step="0.01"></div>
<div class="form-group"><label>Description</label><textarea id="description"></textarea></div>

<button onclick="saveEntry()" style="width:100%;padding:15px;background:var(--primary);color:white;border:none;">Save</button>
</div>
</div>

</div>

<script>
let transactions = JSON.parse(localStorage.getItem("myFinances_v5")) || [];
let monthlyChart = null;

function showPage(id){
document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
document.getElementById(id).classList.add("active");
if(id==="dashboardPage") renderDashboard();
}

function updateCategories(){
const type = document.getElementById("type").value;
const list = type==="Income"
? ["Salary","Gift","Other"]
: ["House Rent","Grocery","Medicine","Conveyance","Travel","Food","Shopping","Fruits","Donations","Others"];
const cat = document.getElementById("category");
cat.innerHTML = list.map(c=>`<option>${c}</option>`).join("");
}

function prepareNewEntry(){
document.getElementById("editIndex").value=-1;
document.getElementById("date").valueAsDate=new Date();
updateCategories();
showPage("inputPage");
}

function saveEntry(){
const i = +document.getElementById("editIndex").value;
const e = {
date:date.value,
type:type.value,
category:category.value,
amount:+amount.value,
description:description.value
};
if(i>-1) transactions[i]=e; else transactions.push(e);
localStorage.setItem("myFinances_v5",JSON.stringify(transactions));
showPage("dashboardPage");
}

function renderDashboard(){
let inc=0,exp=0;
const body=document.getElementById("historyBody");
body.innerHTML="";
transactions.forEach((t,i)=>{
t.type==="Income"?inc+=t.amount:exp+=t.amount;
body.innerHTML+=`<tr><td>${t.date}</td><td>${t.category}</td><td>$${t.amount}</td>
<td><button class="btn-delete" onclick="del(${i})">üóëÔ∏è</button></td></tr>`;
});
dashIncome.innerText=`$${inc.toFixed(2)}`;
dashExpense.innerText=`$${exp.toFixed(2)}`;
dashBalance.innerText=`$${(inc-exp).toFixed(2)}`;
renderMonthlyChart();
}

function del(i){
transactions.splice(i,1);
localStorage.setItem("myFinances_v5",JSON.stringify(transactions));
renderDashboard();
}

function groupByMonth(){
const m={};
transactions.forEach(t=>{
const k=t.date.slice(0,7);
if(!m[k]) m[k]={inc:0,exp:0};
t.type==="Income"?m[k].inc+=t.amount:m[k].exp+=t.amount;
});
return Object.keys(m).map(k=>({
Month:k,
Income:m[k].inc,
Expense:m[k].exp,
Savings:m[k].inc-m[k].exp
}));
}

function renderMonthlyChart(){
const d=groupByMonth();
const ctx=document.getElementById("monthlyChart");
if(monthlyChart) monthlyChart.destroy();
monthlyChart=new Chart(ctx,{
type:"bar",
data:{
labels:d.map(x=>x.Month),
datasets:[
{label:"Income",data:d.map(x=>x.Income),backgroundColor:"#10b981"},
{label:"Expense",data:d.map(x=>x.Expense),backgroundColor:"#f43f5e"},
{label:"Savings",data:d.map(x=>x.Savings),backgroundColor:"#6366f1"}
]
},
options:{responsive:true}
});
}

function downloadCSV(){
const d=groupByMonth();
let csv="Month,Income,Expense,Savings\n";
d.forEach(r=>csv+=`${r.Month},${r.Income},${r.Expense},${r.Savings}\n`);
const a=document.createElement("a");
a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
a.download="finance_monthly.csv";
a.click();
}

function downloadExcel(){
const wb=XLSX.utils.book_new();
const ws=XLSX.utils.json_to_sheet(groupByMonth());
XLSX.utils.book_append_sheet(wb,ws,"Summary");
XLSX.writeFile(wb,"finance_monthly.xlsx");
}

function downloadChart(){
const a=document.createElement("a");
a.href=document.getElementById("monthlyChart").toDataURL("image/png");
a.download="finance_chart.png";
a.click();
}

updateCategories();
renderDashboard();
</script>

</body>
</html>
